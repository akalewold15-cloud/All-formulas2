<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·âÄ·àò·à≠ ·àò·çà·àà·åä·ã´ - Formula Finder</title>
    <style>
        /* CSS ·âÖ·äï·â•·àÆ·âΩ (·àù·äï·àù ·àà·ãç·å• ·ã®·àà·àù) */
        :root {
            --tg-theme-bg-color: #f0f0f0;
            --tg-theme-text-color: #000000;
            --tg-theme-link-color: #007aff;
            --tg-theme-hint-color: #888888;
            --tg-theme-secondary-bg-color: #e6e6e6;
        }

        .dark-theme {
            --tg-theme-bg-color: #17212b;
            --tg-theme-text-color: #ffffff;
            --tg-theme-link-color: #66b4ff;
            --tg-theme-hint-color: #a0a0a0;
            --tg-theme-secondary-bg-color: #213040;
        }

        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* Welcome screen ·ã®·àö·â≥·ã≠·â†·âµ ·àò·äï·åà·ãµ ·â∞·àµ·â∞·ä´·ä≠·àè·àç */
        #welcomeScreen {
            display: none !important; 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 10;
            background-color: var(--tg-theme-bg-color);
            transition: opacity 0.5s ease;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px 0;
        }

        .settings-icon {
            font-size: 1.5em;
            cursor: pointer;
            color: var(--tg-theme-hint-color);
            transition: color 0.2s;
        }

        .full-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 10;
            background-color: var(--tg-theme-bg-color);
            transition: opacity 0.5s ease;
        }
        
        .spinner {
            border: 4px solid var(--tg-theme-hint-color);
            border-top: 4px solid var(--tg-theme-link-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #mainContent, #formulaListScreen, #settingsScreen {
            padding: 20px;
        }

        /* üí• ·ä†·ã≤·àµ CSS ·àà·çà·å£·à™ ·àò·à®·åÉ */
        #creatorInfo {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--tg-theme-text-color); /* ·ãà·ã≠·àù ·àå·àã ·åé·àã ·ã´·àà ·âÄ·àà·àù */
            margin-bottom: 10px;
            text-align: center;
            padding-top: 10px;
        }
        /* ----------------------------------- */

        .category-button, .setting-option {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
            border: none;
            width: 100%;
            box-sizing: border-box;
            text-align: left;
            font-size: 1.1em;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .formula-container {
            display: block;
            background-color: var(--tg-theme-secondary-bg-color);
            border: 1px solid var(--tg-theme-hint-color);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
        }
        
        .formula-container h4 {
            margin-top: 0;
            color: var(--tg-theme-link-color);
        }
        
        .back-button {
            background: none;
            border: none;
            color: var(--tg-theme-link-color);
            font-size: 1.1em;
            padding: 10px 0;
            cursor: pointer;
        }
        
        #globalSearchInput {
            background-color: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
            border: 1px solid var(--tg-theme-hint-color);
            border-radius: 5px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>

    <div id="welcomeScreen" class="full-screen" style="display: none;"> 
        <h1 data-key="welcome_title">·ä•·äï·ä≥·äï ·ã∞·àÖ·äì ·àò·å°!</h1>
        <p data-key="welcome_subtitle">·ãà·ã∞ ·ãì·àà·àù ·ä†·âÄ·çç ·âÄ·àò·à≠ ·àò·çà·àà·åä·ã´ ·ä†·çï·àä·ä¨·àΩ·äï</p>
        </div>

    <div id="loadingScreen" class="full-screen" style="opacity: 0; visibility: hidden;">
        <div class="spinner"></div>
        <p data-key="loading_text">·àò·à®·åÉ·ãé·âΩ ·ä•·ã®·â∞·å´·äë ·äê·ãç...</p>
    </div>

    <div id="mainContent" style="display: none;">
        <div class="header">
            <h2 data-key="main_title">·àù·ãµ·â• ·ã≠·àù·à®·å°</h2>
            <span class="settings-icon" onclick="showSettingsScreen()">‚öôÔ∏è</span>
        </div>
        
        <div id="creatorInfo" data-key="created_by">Created by Akalewold</div>
        <input type="text" id="globalSearchInput" placeholder="·âÄ·àò·à≠ ·â†·ã®·âµ·äõ·ãç·àù ·àù·ãµ·â• ·çà·àç·åç..." style="width: 95%; padding: 10px; margin-bottom: 15px;">

        <div id="categoryList">
            </div>
    </div>
    
    <div id="formulaListScreen" style="display: none;">
        <button class="back-button" onclick="showMainContent()">‚Üê <span data-key="back_to_categories">·ãà·ã∞ ·àù·ãµ·â¶·âΩ ·â∞·àò·àà·àµ</span></button>
        <h2 id="currentCategoryTitle"></h2>
        <div id="formulasInCategory">
            </div>
    </div>
    
    <div id="settingsScreen" style="display: none;">
        <button class="back-button" onclick="showMainContent()">‚Üê <span data-key="back_to_main">·ãà·ã∞ ·ãã·äì·ãç ·åà·åΩ ·â∞·àò·àà·àµ</span></button>
        <h2 data-key="settings_title">·âÖ·äï·â•·àÆ·âΩ</h2>
        
        <h3><span data-key="settings_language">·âã·äï·âã</span>: <span id="currentLanguage"></span></h3>
        <div class="setting-option" onclick="setLanguage('am')">
            <span>Amharic</span>
            <span id="checkAmharic"></span>
        </div>
        <div class="setting-option" onclick="setLanguage('en')">
            <span>English</span>
            <span id="checkEnglish"></span>
        </div>

        <h3><span data-key="settings_theme">·â¥·àù</span>: <span id="currentTheme"></span></h3>
        <div class="setting-option" onclick="setTheme('light')">
            <span data-key="theme_light">·â•·à≠·àÉ·äì·àõ (Light)</span>
            <span id="checkLight"></span>
        </div>
        <div class="setting-option" onclick="setTheme('dark')">
            <span data-key="theme_dark">·å•·âÅ·à≠ (Dark)</span>
            <span id="checkDark"></span>
        </div>
    </div>


    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // --- 2. ·ã®·âã·äï·âã ·àò·à®·åÉ (Translation Data) ---
        const translations = {
            'am': {
                welcome_title: "·ä•·äï·ä≥·äï ·ã∞·àÖ·äì ·àò·å°!",
                welcome_subtitle: "·ãà·ã∞ ·ãì·àà·àù ·ä†·âÄ·çç ·âÄ·àò·à≠ ·àò·çà·àà·åä·ã´ ·ä†·çï·àä·ä¨·àΩ·äï",
                created_by: "Created by Akalewold", // ·ã≠·àÖ ·åΩ·àÅ·çç ·ä†·àÅ·äï ·â†·âµ·àç·âÅ ·ã≠·â≥·ã´·àç
                loading_text: "·àò·à®·åÉ·ãé·âΩ ·ä•·ã®·â∞·å´·äë ·äê·ãç...",
                main_title: "·àù·ãµ·â• ·ã≠·àù·à®·å°",
                back_to_categories: "·ãà·ã∞ ·àù·ãµ·â¶·âΩ ·â∞·àò·àà·àµ",
                back_to_main: "·ãà·ã∞ ·ãã·äì·ãç ·åà·åΩ ·â∞·àò·àà·àµ",
                settings_title: "·âÖ·äï·â•·àÆ·âΩ",
                settings_language: "·âã·äï·âã",
                settings_theme: "·â¥·àù",
                theme_light: "·â•·à≠·àÉ·äì·àõ (Light)",
                theme_dark: "·å•·âÅ·à≠ (Dark)",
                search_placeholder: "·âÄ·àò·à≠ ·â†·ã®·âµ·äõ·ãç·àù ·àù·ãµ·â• ·çà·àç·åç...",
                language_name: { 'am': "·ä†·àõ·à≠·äõ", 'en': "·ä•·äï·åç·àä·ãù·äõ" },
                theme_name: { 'light': "·â•·à≠·àÉ·äì·àõ", 'dark': "·å•·âÅ·à≠" },
                // ·ã®·àù·ãµ·â• ·âµ·à≠·åâ·àû·âΩ:
                "·â£·ãÆ·àé·åÇ": "·â£·ãÆ·àé·åÇ/·å§·äì",
                "·çä·ãö·ä≠·àµ": "·çä·ãö·ä≠·àµ", 
                "·ä¨·àö·àµ·âµ·à™": "·ä¨·àö·àµ·âµ·à™", 
                "·àí·à≥·â•": "·àí·à≥·â•",
                "·ä¢·äÆ·äñ·àö·ä≠·àµ": "·ä¢·äÆ·äñ·àö·ä≠·àµ",
                "·åÇ·ä¶·åç·à´·çä": "·åÇ·ä¶·åç·à´·çä",
                no_formula_found: "·àà·ãö·àÖ ·çç·àà·åã ·àù·äï·àù ·âÄ·àò·à≠ ·ä†·àç·â∞·åà·äò·àù·ç¢",
                formula_word: "·âÄ·àò·à≠",
                category_formulas: "·âÄ·àò·àÆ·âΩ",
                search_result: "·ã®·çç·àà·åã ·ãç·å§·âµ"
            },
            'en': {
                welcome_title: "Welcome!",
                welcome_subtitle: "To the Universal Formula Finder Application",
                created_by: "Created by Akalewold",
                loading_text: "Loading data...",
                main_title: "Select Category",
                back_to_categories: "Back to Categories",
                back_to_main: "Back to Main",
                settings_title: "Settings",
                settings_language: "Language",
                settings_theme: "Theme",
                theme_light: "Light",
                theme_dark: "Dark",
                search_placeholder: "Search formula across all categories...",
                language_name: { 'am': "Amharic", 'en': "English" },
                theme_name: { 'light': "Light", 'dark': "Dark" },
                // ·ã®·àù·ãµ·â• ·âµ·à≠·åâ·àû·âΩ:
                "·â£·ãÆ·àé·åÇ": "Biology/Health",
                "·çä·ãö·ä≠·àµ": "Physics", 
                "·ä¨·àö·àµ·âµ·à™": "Chemistry", 
                "·àí·à≥·â•": "Maths",
                "·ä¢·äÆ·äñ·àö·ä≠·àµ": "Economics",
                "·åÇ·ä¶·åç·à´·çä": "Geography",
                no_formula_found: "No formula found for this search.",
                formula_word: "Formula",
                category_formulas: "Formulas",
                search_result: "Search Result"
            }
        };

        // --- 3. ·ã® ·âÄ·àò·à≠ ·ãù·à≠·ãù·à≠ (·àÅ·àâ·àù ·ã®·â∞·å®·àò·à© ·âÄ·àò·àÆ·âΩ) ---
        const formulas = [
            // --- ·àí·à≥·â• (Mathematics) ---
            { 
                name: { am: "·ä≥·ãµ·à´·â≤·ä≠ ·çé·à≠·àô·àã", en: "Quadratic Formula" }, 
                subject: { am: "·àí·à≥·â•/·ä†·àç·åÄ·â•·à´", en: "Maths/Algebra" }, 
                formula: "x = [-b ¬± sqrt(b¬≤ - 4ac)] / 2a", 
                description: { am: "·àà ax¬≤ + bx + c = 0 ·àò·çç·âµ·àî ·àà·àõ·åç·äò·âµ", en: "To find solutions for ax¬≤ + bx + c = 0" }
            },
            { 
                name: { am: "·çì·ã≠·â≥·åé·à™·ã´·äï ·â¥·à®·àù", en: "Pythagorean Theorem" }, 
                subject: { am: "·àí·à≥·â•/·åÇ·ä¶·àú·âµ·à™", en: "Maths/Geometry" }, 
                formula: "a¬≤ + b¬≤ = c¬≤", 
                description: { am: "·â†·âÄ·äù ·àõ·ãï·ãò·äï ·à∂·àµ·âµ ·àõ·ãï·ãò·äï ·àã·ã≠ ·ã®·åé·äñ·âΩ ·åç·äï·äô·äê·âµ", en: "Relation of sides in a right triangle" }
            },
            { 
                name: { am: "·ã®·ä≠·â†·â• ·àµ·çã·âµ", en: "Area of a Circle" }, 
                subject: { am: "·àí·à≥·â•/·åÇ·ä¶·àú·âµ·à™", en: "Maths/Geometry" }, 
                formula: "A = œÄr¬≤", 
                description: { am: "Radius (r) ·ã´·àà·ãç ·ã®·ä≠·â†·â• ·àµ·çã·âµ", en: "Area of a circle with radius (r)" }
            },
            { 
                name: { am: "·ã®·â∞·ãã·åΩ·ä¶ ·àÖ·åç (Power Rule)", en: "Derivative (Power Rule)" }, 
                subject: { am: "·àí·à≥·â•/·ä´·àç·ä©·àà·àµ", en: "Maths/Calculus" }, 
                formula: "d/dx(x‚Åø) = n * x‚Åø‚Åª¬π", 
                description: { am: "·ã®·ä†·äï·ãµ ·äÉ·ã≠·àç ·â∞·åç·â£·à≠ ·â∞·ãã·åΩ·ä¶·äï ·àà·àõ·åç·äò·âµ", en: "To find the derivative of a power function" }
            },
            { 
                name: { am: "·ã®·àé·åã·à™·ãù·àù ·àÖ·åç", en: "Logarithm Rule" }, 
                subject: { am: "·àí·à≥·â•/·ä†·àç·åÄ·â•·à´", en: "Maths/Algebra" }, 
                formula: "log‚Çê(x) = ln(x) / ln(a)", 
                description: { am: "·àé·åã·à™·ãù·àù·äï ·ä®·â∞·àà·ã´·ã® ·àò·à†·à®·âµ ·ãà·ã∞ ·â∞·çà·å•·àØ·ãä ·àò·à†·à®·âµ ·àà·àò·âÄ·ã®·à≠", en: "To convert logarithm from any base to natural base" }
            },
             { 
                name: { am: "·ä†·àõ·ä´·ã≠ (Mean)", en: "Arithmetic Mean" }, 
                subject: { am: "·àí·à≥·â•/·àµ·â≥·â≤·àµ·â≤·ä≠·àµ", en: "Maths/Statistics" }, 
                formula: "xÃÑ = (‚àëx) / n", 
                description: { am: "·ã®·ä†·äï·ãµ ·ã®·ãç·àÇ·â• ·àµ·â•·àµ·â• ·ä†·àõ·ä´·ã≠", en: "Average of a set of data" }
            },
            { 
                name: { am: "·ã®·àò·â∂·äõ ·àà·ãç·å•", en: "Percentage Change" }, 
                subject: { am: "·àí·à≥·â•/·çã·ã≠·äì·äï·àµ", en: "Maths/Finance" }, 
                formula: "Change% = [(New - Old) / Old] √ó 100", 
                description: { am: "·â†·àÅ·àà·âµ ·ä•·à¥·â∂·âΩ ·àò·ä´·ä®·àç ·ã´·àà·ãç·äï ·àò·â∂·äõ ·àà·ãç·å• ·àà·àõ·åç·äò·âµ", en: "To find the percentage change between two values" }
            },
            // --- ·çä·ãö·ä≠·àµ (Physics) ---
            { 
                name: { am: "·åâ·àç·â†·âµ (Force - ·äí·ãç·â∞·äï 2·äõ ·àÖ·åç)", en: "Force (Newton's 2nd Law)" }, 
                subject: { am: "·çä·ãö·ä≠·àµ/·àú·ä´·äí·ä≠·àµ", en: "Physics/Mechanics" }, 
                formula: "F = m * a", 
                description: { am: "·åâ·àç·â†·âµ = ·ã®·åÖ·àù·àã √ó ·çç·å•·äï·å•·äê·âµ", en: "Force = mass √ó acceleration" }
            },
            { 
                name: { am: "·åâ·àç·â†·âµ (·ä™·äê·â≤·ä≠ ·ä¢·äê·à≠·åÇ)", en: "Kinetic Energy" }, 
                subject: { am: "·çä·ãö·ä≠·àµ/·ä¢·äê·à≠·åÇ", en: "Physics/Energy" }, 
                formula: "KE = (1/2)mv¬≤", 
                description: { am: "·â†·ä•·äï·âÖ·àµ·âÉ·à¥ ·àù·ä≠·äï·ã´·âµ ·ã®·àö·àò·å£ ·åâ·àç·â†·âµ", en: "Energy due to motion" }
            },
            { 
                name: { am: "·ã®·àô·âÄ·âµ ·àà·ãç·å•", en: "Heat Transfer (Q)" }, 
                subject: { am: "·çä·ãö·ä≠·àµ/·â¥·à≠·àû·ã≥·ã≠·äì·àö·ä≠·àµ", en: "Physics/Thermodynamics" }, 
                formula: "Q = mcŒîT", 
                description: { am: "·ã®·åÖ·àù·àã (m) ·ã®·àÜ·äê ·äê·åà·à≠ ·ã®·àô·âÄ·âµ ·àà·ãç·å• ·àà·àõ·åç·äò·âµ", en: "To find the heat change for a mass (m) with specific heat (c)" }
            },
            { 
                name: { am: "·ã®·àµ·à´ ·âÄ·àò·à≠", en: "Work Formula" }, 
                subject: { am: "·çä·ãö·ä≠·àµ/·àú·ä´·äí·ä≠·àµ", en: "Physics/Mechanics" }, 
                formula: "W = F * d", 
                description: { am: "·àµ·à´ = ·åâ·àç·â†·âµ √ó ·à≠·âÄ·âµ", en: "Work done equals Force times displacement" }
            },
            { 
                name: { am: "·ã®·ä§·àå·ä≠·âµ·à™·ä≠ ·äÉ·ã≠·àç", en: "Electric Power" }, 
                subject: { am: "·çä·ãö·ä≠·àµ/·ä§·àå·ä≠·âµ·à™·ä≠", en: "Physics/Electric" }, 
                formula: "P = IV", 
                description: { am: "·äÉ·ã≠·àç = ·åÖ·à®·âµ √ó ·âÆ·àç·â¥·åÖ", en: "Power equals Current times Voltage" }
            },
             { 
                name: { am: "·ã®·ä§·àå·ä≠·âµ·à™·ä≠ ·âÆ·àç·â¥·åÖ (Ohm's Law)", en: "Electric Voltage (Ohm's Law)" }, 
                subject: { am: "·çä·ãö·ä≠·àµ/·ä§·àå·ä≠·âµ·à™·ä≠", en: "Physics/Electric" }, 
                formula: "V = I * R", 
                description: { am: "·âÆ·àç·â¥·åÖ = ·åÖ·à®·âµ √ó ·àò·âã·âã·àù", en: "Voltage = Current √ó Resistance" }
            },
            // --- ·ä¨·àö·àµ·âµ·à™ (Chemistry) ---
            { 
                name: { am: "·àû·àç ·â•·ãõ·âµ (Moles)", en: "Moles" }, 
                subject: { am: "·ä¨·àö·àµ·âµ·à™/·àµ·àå·âµ", en: "Chemistry/Calculations" }, 
                formula: "n = m / M", 
                description: { am: "·àû·àç = ·ã®·åÖ·àù·àã / ·àû·àã·à≠ ·ä≠·â•·ã∞·âµ", en: "Moles = Mass / Molar Mass" }
            },
            { 
                name: { am: "·ã®·åã·ãù ·àÖ·åç (Ideal Gas Law)", en: "Ideal Gas Law" }, 
                subject: { am: "·ä¨·àö·àµ·âµ·à™/·åã·ãù", en: "Chemistry/Gas" }, 
                formula: "PV = nRT", 
                description: { am: "·åç·çä·âµ √ó ·àò·å†·äï = ·àû·àç √ó ·âã·àö √ó ·ã®·àô·âÄ·âµ ·àò·å†·äï", en: "Pressure √ó Volume = Moles √ó Constant √ó Temperature" }
            },
            { 
                name: { am: "·çí ·ä§·âΩ (pH)", en: "pH" }, 
                subject: { am: "·ä¨·àö·àµ·âµ·à™/·ä†·à≤·ãµ", en: "Chemistry/Acids" }, 
                formula: "pH = -log[H‚Å∫]", 
                description: { am: "·ã®·ä†·à≤·ã≥·àõ·äê·âµ ·àò·àà·ä™·ã´", en: "Measure of acidity" }
            },
            { 
                name: { am: "·ã®·ä¨·àö·ä´·àç ·ä•·ä©·àç·äê·âµ (Kc)", en: "Equilibrium Constant (Kc)" }, 
                subject: { am: "·ä¨·àö·àµ·âµ·à™/·à™·ä†·ä≠·àΩ·äï", en: "Chemistry/Reactions" }, 
                formula: "Kc = [C]·∂ú[D]·µà / [A]·µÉ[B]·µá", 
                description: { am: "·ã®·ä¨·àö·ä´·àç ·à™·ä†·ä≠·àΩ·äï ·ä•·ä©·àç·äê·âµ ·àà·àõ·åç·äò·âµ", en: "To find the chemical reaction equilibrium constant" }
            },
            { 
                name: { am: "·àû·àã·à™·â≤ (Molarity)", en: "Molarity" }, 
                subject: { am: "·ä¨·àö·àµ·âµ·à™/·àò·çç·âµ·àÑ", en: "Chemistry/Solutions" }, 
                formula: "M = mol / L", 
                description: { am: "·àû·àç ·ã®·àü·àö ·â†·àä·âµ·à≠ ·àò·çç·âµ·àÑ", en: "Moles of solute per liter of solution" }
            },
            { 
                name: { am: "·ã®·àû·àç ·ä≠·çç·àç·çã·ã≠", en: "Mole Fraction" }, 
                subject: { am: "·ä¨·àö·àµ·âµ·à™/·àò·çç·âµ·àÑ", en: "Chemistry/Solutions" }, 
                formula: "x·µ¢ = n·µ¢ / n(total)", 
                description: { am: "·ã®·ä†·äï·ãµ ·ä†·ä´·àç ·àû·àç ·â†·ä†·å†·âÉ·àã·ã≠ ·àû·àç ·à≤·ä´·çà·àç", en: "Moles of one component divided by total moles" }
            },
            
            // --- ·â£·ãÆ·àé·åÇ/·å§·äì (Biology/Health) ---
            { 
                name: { am: "·ã®·à∞·ãç·äê·âµ ·ä≠·â•·ã∞·âµ ·àò·àò·ãò·äõ (BMI)", en: "Body Mass Index (BMI)" }, 
                subject: { am: "·â£·ãÆ·àé·åÇ/·å§·äì", en: "Biology/Health" }, 
                formula: "BMI = mass(kg) / height(m)¬≤", 
                description: { am: "·ã®·à∞·ãç·äê·âµ ·ä≠·â•·ã∞·âµ ·ä•·äì ·âÅ·àò·âµ ·àò·àò·ãò·äõ", en: "A measure of body weight relative to height" }
            },
            { 
                name: { am: "·ã®·àò·â∞·äï·çà·àª ·àù·âµ (RR)", en: "Respiratory Rate (RR)" }, 
                subject: { am: "·â£·ãÆ·àé·åÇ/·àò·â∞·äï·çà·àª", en: "Biology/Respiratory" }, 
                formula: "RR = Breaths / Minute", 
                description: { am: "·â†·ã∞·âÇ·âÉ ·ã®·àö·ãà·à∞·ã± ·ã®·ä†·â∞·äê·çã·çà·àµ ·â•·ãõ·âµ", en: "Number of breaths taken per minute" }
            },
            { 
                name: { am: "·ã®·åÑ·äî·â≤·ä≠ ·ä•·ãµ·àç", en: "Genetic Probability" }, 
                subject: { am: "·â£·ãÆ·àé·åÇ/·åÑ·äî·â≤·ä≠·àµ", en: "Biology/Genetics" }, 
                formula: "P(A) √ó P(B) = P(A and B)", 
                description: { am: "·ã®·àÅ·àà·âµ ·åà·àà·àç·â∞·äõ ·ä≠·àµ·â∞·â∂·âΩ ·ã®·àò·ä®·à∞·âµ ·ä•·ãµ·àç", en: "Probability of two independent events occurring" }
            },
            { 
                name: { am: "·ã®·àç·â• ·àù·âµ (HR)", en: "Heart Rate (HR)" }, 
                subject: { am: "·â£·ãÆ·àé·åÇ/·å§·äì", en: "Biology/Health" }, 
                formula: "HR = 60 / Interval(sec)", 
                description: { am: "·â†·ã∞·âÇ·âÉ ·ã®·àç·â• ·àù·â∂·âΩ ·â•·ãõ·âµ", en: "Number of heartbeats per minute" }
            },
            { 
                name: { am: "·ã®·à≥·äï·â£ ·ä†·âÖ·àù (TLC)", en: "Total Lung Capacity (TLC)" }, 
                subject: { am: "·â£·ãÆ·àé·åÇ/·àò·â∞·äï·çà·àª", en: "Biology/Respiratory" }, 
                formula: "TLC = V·¥õ + IRV + ERV + RV", 
                description: { am: "·å†·âÖ·àã·àã ·ã®·à≥·äï·â£ ·ä†·âÖ·àù", en: "Total volume of air in the lungs after a maximal inspiration" }
            },
            
            // --- ·ä¢·äÆ·äñ·àö·ä≠·àµ ·ä•·äì ·àå·àé·âΩ (Economics & Other) ---
            { 
                name: { am: "·âÄ·àã·àç ·ãà·àà·ãµ (Simple Interest)", en: "Simple Interest" }, 
                subject: { am: "·ä¢·äÆ·äñ·àö·ä≠·àµ/·çã·ã≠·äì·äï·àµ", en: "Economics/Finance" }, 
                formula: "I = P * r * t", 
                description: { am: "·ãà·àà·ãµ = ·ãã·äì·ãç ·â•·ãµ·à≠ √ó ·ã®·ãà·àà·ãµ ·àò·å†·äï √ó ·åä·ãú", en: "Interest = Principal √ó Rate √ó Time" }
            },
            { 
                name: { am: "·ã®·ãã·åã ·ã®·àò·àà·å†·å• (Demand Elasticity)", en: "Price Elasticity of Demand" }, 
                subject: { am: "·ä¢·äÆ·äñ·àö·ä≠·àµ/·åà·â†·ã´", en: "Economics/Market" }, 
                formula: "E = (% Œî Quantity) / (% Œî Price)", 
                description: { am: "·ã®·ãã·åã ·àà·ãç·å• ·â†·àù·à≠·âµ ·çç·àã·åé·âµ ·àã·ã≠ ·ã®·àö·ã´·à≥·ãµ·à®·ãç ·â∞·åΩ·ãï·äñ", en: "Impact of price change on product demand" }
            },
             { 
                name: { am: "·ã®·àï·ãù·â• ·ä•·ãµ·åà·âµ ·çç·å•·äê·âµ", en: "Population Growth Rate" }, 
                subject: { am: "·åÇ·ä¶·åç·à´·çä/·àµ·äê ·àï·ãù·â•", en: "Geography/Demography" }, 
                formula: "R = (B - D) / P", 
                description: { am: "·ä•·ãµ·åà·âµ = (·àç·ã∞·âµ - ·àû·âµ) / ·ä†·å†·âÉ·àã·ã≠ ·àÖ·ãù·â•", en: "Growth = (Births - Deaths) / Total Population" }
            }
        ];

        // --- 4. ·åç·àé·â£·àç ·â∞·àà·ãã·ãã·åÆ·âΩ ·ä•·äì ·â∞·åç·â£·à´·âµ ---
        let currentLang = localStorage.getItem('appLang') || 'am';
        let currentTheme = localStorage.getItem('appTheme') || 'light';
        let categories = []; 
        let categorizedFormulas = {}; 

        const welcomeScreen = document.getElementById('welcomeScreen');
        const loadingScreen = document.getElementById('loadingScreen');
        const mainContent = document.getElementById('mainContent');
        const formulaListScreen = document.getElementById('formulaListScreen');
        const settingsScreen = document.getElementById('settingsScreen');
        const categoryList = document.getElementById('categoryList');
        const formulasInCategory = document.getElementById('formulasInCategory');
        const currentCategoryTitle = document.getElementById('currentCategoryTitle');
        const globalSearchInput = document.getElementById('globalSearchInput');
        
        function applyTranslations() {
            const t = translations[currentLang];
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (t[key]) el.textContent = t[key];
            });
            globalSearchInput.placeholder = t.search_placeholder;
            document.getElementById('currentLanguage').textContent = t.language_name[currentLang];
            document.getElementById('currentTheme').textContent = t.theme_name[currentTheme];
            updateSettingsChecks();
            renderCategories();
        }

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('appLang', lang);
            applyTranslations();
            if (formulaListScreen.style.display !== 'none' || settingsScreen.style.display !== 'none') {
                showMainContent(); 
            }
        }
        
        function setTheme(theme) {
            currentTheme = theme;
            localStorage.setItem('appTheme', theme);
            document.body.classList.remove('dark-theme');
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
            }
            applyTranslations();
        }
        
        function updateSettingsChecks() {
            document.getElementById('checkAmharic').textContent = currentLang === 'am' ? '‚úÖ' : '';
            document.getElementById('checkEnglish').textContent = currentLang === 'en' ? '‚úÖ' : '';
            document.getElementById('checkLight').textContent = currentTheme === 'light' ? '‚úÖ' : '';
            document.getElementById('checkDark').textContent = currentTheme === 'dark' ? '‚úÖ' : '';
        }

        function showSettingsScreen() {
            mainContent.style.display = 'none';
            formulaListScreen.style.display = 'none';
            settingsScreen.style.display = 'block';
            updateSettingsChecks();
        }

        /* ----------------------------------------------- */
        /* ·ã®·àò·å®·à®·àª·ãç ·ã®initializeApp() ·â∞·åç·â£·à≠ (Welcome screen·äï ·ã≠·ãò·àç·àã·àç) */
        /* ----------------------------------------------- */
        function initializeApp() {
            setTheme(currentTheme); 
            applyTranslations(); 

            // ·â†·â¥·àå·åç·à´·àù ·ãç·àµ·å• ·ãà·ã≠·àù ·â†·ãå·â• ·â•·àÆ·ãç·ãò·à≠ ·ãç·àµ·å• ·ä´·àà·äï
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready(); 
                
                // ·ãà·ã≤·ã´·ãç·äë ·ãà·ã∞ ·àé·ã≤·äï·åç ·àµ·ä≠·à™·äï ·ã≠·àÇ·ãµ (Welcome screen ·àµ·àà·â∞·à∞·ãà·à®)
                loadingScreen.style.visibility = 'visible';
                loadingScreen.style.opacity = 1;
                
                // ·äÆ·äï·â¥·äï·â±·äï ·â†·çç·å•·äê·âµ ·àé·ãµ ·ã´·ãµ·à≠·åç
                setTimeout(loadContent, 100); 
                
            } else {
                // ·â† Chrome/Web Browser ·ãç·àµ·å• ·àµ·äï·àÜ·äï (Welcome screen·äï ·ä†·ã≠·ãù·àç·àù)
                welcomeScreen.style.display = 'flex'; // Welcome screen·äï ·ä†·à≥·ã≠
                setTimeout(() => {
                    welcomeScreen.style.opacity = 0;
                    loadingScreen.style.visibility = 'visible';
                    loadingScreen.style.opacity = 1;
                    
                    setTimeout(loadContent, 1000); 
                }, 2000); 
            }

            globalSearchInput.addEventListener('input', handleGlobalSearch);
        }
        /* ----------------------------------------------- */
        

        function loadContent() {
            formulas.forEach(item => {
                const primarySubject = item.subject.am.split('/')[0]; 
                if (!categorizedFormulas[primarySubject]) {
                    categorizedFormulas[primarySubject] = [];
                    categories.push(primarySubject);
                }
                categorizedFormulas[primarySubject].push(item);
            });
            categories.sort(); 
            renderCategories();
            showMainContent();
        }

        function renderCategories() {
            categoryList.innerHTML = '';
            categories.forEach(categoryAmharic => {
                const count = categorizedFormulas[categoryAmharic].length;
                const button = document.createElement('button');
                button.className = 'category-button';
                let translatedName = translations[currentLang][categoryAmharic] || categoryAmharic;
                
                button.innerHTML = `${translatedName} <span>(${count}) ‚Üí</span>`;
                button.onclick = () => showFormulas(categoryAmharic); 
                categoryList.appendChild(button);
            });
        }
        
        function showMainContent() {
            settingsScreen.style.display = 'none'; 
            mainContent.style.display = 'block';
            formulaListScreen.style.display = 'none';
            loadingScreen.style.visibility = 'hidden';
            welcomeScreen.style.display = 'none';
            globalSearchInput.value = '';
            renderCategories(); 
        }

        function showFormulas(categoryAmharic) {
            const categoryName = categoryAmharic;
            const categoryTitle = translations[currentLang][categoryName] || categoryName; 
            
            currentCategoryTitle.textContent = `${categoryTitle} ${translations[currentLang].category_formulas}`;
            mainContent.style.display = 'none';
            formulaListScreen.style.display = 'block';
            
            renderFormulaList(categorizedFormulas[categoryAmharic]);
        }

        function renderFormulaList(formulaData) {
            formulasInCategory.innerHTML = '';
            if (formulaData.length === 0) {
                 formulasInCategory.innerHTML = `<p style="text-align: center;">${translations[currentLang].no_formula_found}</p>`;
                 return;
            }

            formulaData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'formula-container';
                div.innerHTML = `
                    <h4>${item.name[currentLang] || item.name.am}</h4>
                    <p style="font-size: 0.9em; color: var(--tg-theme-hint-color);">(${item.subject[currentLang] || item.subject.am})</p>
                    <strong>${translations[currentLang].formula_word}:</strong> <code>${item.formula}</code><br>
                    <p>${item.description[currentLang] || item.description.am}</p>
                `;
                formulasInCategory.appendChild(div);
            });
        }
        
        function handleGlobalSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            if (searchTerm.length > 0) {
                const filtered = formulas.filter(item => 
                    item.name.am.toLowerCase().includes(searchTerm) || 
                    (item.name.en && item.name.en.toLowerCase().includes(searchTerm)) || 
                    item.subject.am.toLowerCase().includes(searchTerm) ||
                    (item.subject.en && item.subject.en.toLowerCase().includes(searchTerm)) ||
                    item.description.am.toLowerCase().includes(searchTerm) ||
                    (item.description.en && item.description.en.toLowerCase().includes(searchTerm))
                );
                currentCategoryTitle.textContent = `${translations[currentLang].search_result} (${filtered.length})`;
                mainContent.style.display = 'none';
                formulaListScreen.style.display = 'block';
                renderFormulaList(filtered);
            } else {
                showMainContent(); 
            }
        }


        initializeApp();
    </script>
</body>
</html>
